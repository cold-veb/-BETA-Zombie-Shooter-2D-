<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Zombie Shooter</title>
<style>
html, body {margin:0;padding:0;overflow:hidden;background:black;font-family:Arial;color:white;}
canvas {display:block;}
.menu,.gameover,.modes,.battlepass,.shop,.chests {position:fixed;inset:0;background:#0044cc;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10;}
.hidden {display:none;}
button {padding:14px 22px;margin:10px;font-size:18px;border:none;border-radius:10px;cursor:pointer;}
.balance {position:absolute;top:15px;right:20px;font-size:20px;}
.stats {margin-top:10px;font-size:18px;}
.task {margin:10px;text-align:center;}
.chest-btn {position:absolute;top:10px;left:10px;padding:10px 15px;background:orange;color:black;border-radius:8px;cursor:pointer;}
</style>
</head>
<body>
<canvas id="game"></canvas>

<!-- –ú–ï–ù–Æ -->
<div id="menu" class="menu">
  <div class="balance" id="menuCoins">üí∞ 0</div>
  <h1>üßü Zombie Shooter</h1>
  <button onclick="openModes()">‚ñ∂ –ò–≥—Ä–∞—Ç—å</button>
  <button onclick="openBattlePass()">üéü –ó–∞–¥–∞–Ω–∏—è</button>
  <button onclick="openShop()">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
  <div class="stats" id="menuStats"></div>
</div>

<!-- –ú–ï–ù–Æ –†–ï–ñ–ò–ú–û–í -->
<div id="modes" class="modes hidden">
  <h1>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º</h1>
  <button onclick="selectMode('standard')">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (5 –≤–æ–ª–Ω)</button>
  <button onclick="selectMode('christmas')">üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π‚õÑ</button>
  <button onclick="selectMode('timer')">–¢–∞–π–º–µ—Ä –Ω–∞ –Ω—É–ª–µ (30 —Å–µ–∫)</button>
  <button onclick="openMenu()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<!-- BATTLE PASS -->
<div id="battlepass" class="battlepass hidden">
  <h1>üéü –ó–∞–¥–∞–Ω–∏—è</h1>
  <div class="task">
    <div style="color:lightgreen">–ü—Ä–æ—Å—Ç–æ</div>
    <div>–£–±–∏—Ç—å 50 –∑–æ–º–±–∏</div>
    <div id="task1"></div>
  </div>
  <div class="task">
    <div style="color:yellow">–°—Ä–µ–¥–Ω–µ</div>
    <div>–£–±–∏—Ç—å 200 –∑–æ–º–±–∏</div>
    <div id="task2"></div>
  </div>
  <div class="task">
    <div style="color:red">–¢—è–∂–µ–ª–æ</div>
    <div>–£–±–∏—Ç—å 1000 –∑–æ–º–±–∏ –∏ –ø–æ–∏–≥—Ä–∞—Ç—å 10 –º–∏–Ω—É—Ç</div>
    <div id="task3"></div>
  </div>
  <button id="claimRewardBtn" onclick="claimRewards()">üí∞ –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>
  <button class="chest-btn" onclick="openChests()">–°—É–Ω–¥—É–∫–∏</button>
  <button onclick="openMenu()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<!-- –ú–ê–ì–ê–ó–ò–ù -->
<div id="shop" class="shop hidden">
  <h1>üõí –ú–∞–≥–∞–∑–∏–Ω</h1>
  <div id="shopItems"></div>
  <button onclick="openMenu()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<!-- –°–£–ù–î–£–ö–ò -->
<div id="chests" class="chests hidden">
  <h1>–°—É–Ω–¥—É–∫–∏</h1>
  <div>
    <button onclick="openChest('normal')">–û–±—ã—á–Ω—ã–π</button>
    <button onclick="openChest('medium')">–°—Ä–µ–¥–Ω–∏–π</button>
    <button onclick="openChest('legend')">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π</button>
  </div>
  <div id="chestResult"></div>
  <button onclick="openBattlePass()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<!-- GAME OVER -->
<div id="gameover" class="gameover hidden">
  <h1>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</h1>
  <button onclick="startGame()">üîÅ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
  <button onclick="openMenu()">üìã –ú–µ–Ω—é</button>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
resize();addEventListener("resize",resize);

/* ===== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===== */
let state="menu",zombies=[],bullets=[],kills=0,coins=Number(localStorage.getItem("coins"))||0,fenceHP=500;
let wave=1,maxWaves=5,waveTime=20,waveTimer=20,wavePause=false,pauseTimer=0;
let spawnRate=0.02,zombieSpeed=1.2,lastTime=Date.now();
let currentMode="standard";
let weapons={
  "Pistol": {delay:0.8, bullets:1, price:0, owned:true},
  "Tek-9": {delay:1, bullets:2, price:200, owned:false},
  "Shotgun": {delay:0.4, bullets:3, spread:true, price:350, owned:false},
  "UMP": {delay:0.5, bullets:3, spread:true, burst:3, burstDelay:200, price:1000, owned:false},
  "MachineGun": {delay:0.1, bullets:5, spread:true, price:1500, owned:false},
  "ICE Gun": {delay:0.5, bullets:3, spread:false, price:599, owned:false}
};
let currentWeapon="Pistol",lastShot=0,autoFireQueue=[];
let taskData={t1:false,t2:false,t3:false};
let lastTaskUpdate=Date.now();

// –§–ª–∞–≥ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—É–Ω–¥—É–∫–æ–≤
let chestOpened = {normal:false, medium:false, legend:false};

/* ===== –ò–ì–†–ê ===== */
function startGame(){
    state="game";zombies=[];bullets=[];kills=0;fenceHP=500;
    wave=1;waveTimer=waveTime;wavePause=false;pauseTimer=0;
    spawnRate=0.02;zombieSpeed=1.2;
    hideAll();
}
function openMenu(){hideAll();state="menu";updateMenu();menu.classList.remove("hidden");}
function openModes(){hideAll();modes.classList.remove("hidden");}
function openBattlePass(){hideAll();battlepass.classList.remove("hidden");updateTasks();}
function openShop(){hideAll();shop.classList.remove("hidden");updateShop();}
function openChests(){hideAll();chests.classList.remove("hidden");document.getElementById("chestResult").innerText="";}
function hideAll(){menu.classList.add("hidden");modes.classList.add("hidden");battlepass.classList.add("hidden");shop.classList.add("hidden");gameover.classList.add("hidden");chests.classList.add("hidden");}

/* ===== –í–´–ë–û–† –†–ï–ñ–ò–ú–ê ===== */
function selectMode(mode){
    currentMode=mode;
    startGame();
}

/* ===== –ú–ê–ì–ê–ó–ò–ù ===== */
function updateShop(){
    let html="";
    for(let w in weapons){
        let weap=weapons[w];
        html+=`<div style="margin:10px"><b>${w}</b> - ${weap.price}üí∞<br><button onclick="buyEquip('${w}')">${weap.owned?(currentWeapon===w?"–≠–∫–∏–ø–∏—Ä–æ–≤–∞–Ω–æ":"–≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å"):"–ö—É–ø–∏—Ç—å"}</button></div>`;
    }
    document.getElementById("shopItems").innerHTML=html;
}
function buyEquip(name){
    let weap=weapons[name];
    if(!weap.owned){
        if(coins>=weap.price){coins-=weap.price;weap.owned=true;}
        else{alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");return;}
    }
    currentWeapon=name;
    updateShop();
}

/* ===== –ó–ê–î–ê–ù–ò–Ø ===== */
function updateTasks(){
    let t1=taskData.t1?50:Math.min(kills,50);
    let t2=taskData.t2?200:Math.min(kills,200);
    let t3=taskData.t3?1000:Math.min(kills,1000);
    document.getElementById("task1").innerText=t1+"/50";
    document.getElementById("task2").innerText=t2+"/200";
    document.getElementById("task3").innerText=t3+"/1000";
}
function claimRewards(){
    if(taskData.t1===false && kills>=50){coins+=50;taskData.t1=true;}
    if(taskData.t2===false && kills>=200){coins+=200;taskData.t2=true;}
    if(taskData.t3===false && kills>=1000){coins+=500;taskData.t3=true;}
    updateTasks();updateMenu();
}

/* ===== –°–£–ù–î–£–ö–ò ===== */
function openChest(type){
    if(chestOpened[type]) { alert("–í—ã —É–∂–µ –æ—Ç–∫—Ä—ã–ª–∏ —ç—Ç–æ—Ç —Å—É–Ω–¥—É–∫!"); return; }
    if(!taskData.t1 || !taskData.t2 || !taskData.t3){alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è!"); return;}

    let chance=Math.random()*100, reward=0;
    if(type==="normal"){
        if(chance<75) reward=35; else if(chance<90) reward=80; else if(chance<99) reward=120; else reward=200;
    }else if(type==="medium"){
        if(chance<80) reward=70; else if(chance<93) reward=100; else if(chance<98) reward=150; else reward=200;
    }else{
        if(chance<91) reward=100; else if(chance<96) reward=250; else if(chance<99) reward=500; else if(chance<99.99) reward=1000; else reward=100000;
    }
    coins+=reward; 
    document.getElementById("chestResult").innerText=`–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${reward} –º–æ–Ω–µ—Ç!`;
    chestOpened[type] = true;
    updateMenu();
}

// —Å–±—Ä–æ—Å –∑–∞–¥–∞–Ω–∏–π –∏ —Å—É–Ω–¥—É–∫–æ–≤ –∫–∞–∂–¥—ã–µ 25 –º–∏–Ω—É—Ç
setInterval(()=>{
    taskData={t1:false,t2:false,t3:false};
    chestOpened={normal:false, medium:false, legend:false};
    updateTasks();
},25*60*1000);

/* ===== –ö–ù–û–ü–ö–ò ===== */
function updateMenu(){
    document.getElementById("menuCoins").innerText="üí∞ "+coins;
    document.getElementById("menuStats").innerText=`–£–±–∏–π—Å—Ç–≤ –≤—Å–µ–≥–æ: ${kills}`;
}

/* ===== –°–ü–ê–í–ù –ó–û–ú–ë–ò ===== */
function spawnZombie(){zombies.push({x:Math.random()*(canvas.width-40),y:-40,hp:1});}

/* ===== –í–í–û–î ===== */
canvas.addEventListener("mousedown", shoot);
canvas.addEventListener("touchstart", shoot);

function shoot(e){
    if(state!=="game") return;
    const rect=canvas.getBoundingClientRect();
    let x=(e.clientX||e.touches[0].clientX)-rect.left;
    let y=canvas.height-90;
    let now=Date.now();
    let weapon=weapons[currentWeapon];
    if(currentWeapon==="UMP"){
        for(let i=0;i<weapon.burst;i++){
            autoFireQueue.push({x:x,y:y,bullets:weapon.bullets,time:now+i*weapon.burstDelay});
        }
    }else{
        if(now-lastShot<weapon.delay*1000) return;
        lastShot=now;
        for(let i=0;i<weapon.bullets;i++){
            let offset=weapon.spread?(i-(weapon.bullets-1)/2)*12:0;
            bullets.push({x:x+offset,y:y,flash:5});
        }
    }
}

/* ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï ===== */
function update(){
    if(state!=="game") return;
    const now=Date.now(),delta=(now-lastTime)/1000;lastTime=now;

    if(currentMode!=="timer"){
        if(!wavePause){waveTimer-=delta;if(Math.random()<spawnRate) spawnZombie();}
        else{pauseTimer-=delta;if(pauseTimer<=0){wavePause=false;waveTimer=waveTime;}}
        if(waveTimer<=0&&!wavePause){wavePause=true;pauseTimer=3;wave++;spawnRate+=0.01;zombieSpeed+=0.3;if(wave>maxWaves) endGame();}
    }else{waveTimer-=delta;if(waveTimer<=0) endGame();if(Math.random()<0.08) spawnZombie();}

    bullets.forEach(b=>b.y-=12);
    let nowMs=Date.now();
    autoFireQueue=autoFireQueue.filter(f=>{
        if(nowMs>=f.time){for(let i=0;i<f.bullets;i++){let offset=(i-(f.bullets-1)/2)*12; bullets.push({x:f.x+offset,y:f.y,flash:5});} return false;}
        return true;
    });

    // ===== –£–ë–ò–ô–°–¢–í–û –ó–û–ú–ë–ò =====
    zombies.forEach((z,i)=>{
        bullets.forEach((b,j)=>{
            if(b.x>z.x && b.x<z.x+35 && b.y>z.y && b.y<z.y+35){
                z.hp--; 
                bullets.splice(j,1);
                if(z.hp<=0){
                    zombies.splice(i,1);
                    kills++; coins++;
                }
            }
        });
    });

    // –∑–æ–º–±–∏ –¥–≤–∏–∂–µ–Ω–∏–µ
    zombies.forEach(z=>{z.y+=zombieSpeed;if(z.y>canvas.height-50){fenceHP-=35;z.y=9999;kills++;coins++;}});

    zombies=zombies.filter(z=>z.y<canvas.height); bullets=bullets.filter(b=>b.y>0);
    if(fenceHP<=0) endGame();
}

/* ===== –ö–û–ù–ï–¶ –ò–ì–†–´ ===== */
function endGame(){state="over";hideAll();gameover.classList.remove("hidden");updateMenu();}

/* ===== –û–¢–†–ò–°–û–í–ö–ê ===== */
let snow=[];
for(let i=0;i<200;i++){snow.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,vy:0.3+Math.random()*0.2});}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(state!=="game") return;
    // —Ñ–æ–Ω
    ctx.fillStyle=currentMode==="christmas"?"#87CEEB":"#228B22";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    // —Å–Ω–µ–≥
    if(currentMode==="christmas"){
        ctx.fillStyle="white";
        snow.forEach(s=>{
            ctx.beginPath();ctx.arc(s.x,s.y,3,0,Math.PI*2);ctx.fill();
            s.y+=s.vy;if(s.y>canvas.height) s.y=0;
        });
    }
    // –∑–∞–±–æ—Ä
    ctx.fillStyle="red";ctx.fillRect(0,canvas.height-50,canvas.width,50);
    // HUD
    ctx.fillStyle="white";ctx.font="20px Arial";
    ctx.fillText(`üíÄ –£–±–∏—Ç–æ: ${kills}`,10,30);
    ctx.fillText(`üí∞ –ú–æ–Ω–µ—Ç—ã: ${coins}`,10,60);
    ctx.fillText(`üß± –ó–∞–±–æ—Ä HP: ${fenceHP}`,10,90);
    if(currentMode!=="timer") ctx.fillText(`üåä ${wave} –≤–æ–ª–Ω–∞: ${Math.ceil(waveTimer)} —Å–µ–∫`,10,120);
    else ctx.fillText(`‚è± –¢–∞–π–º–µ—Ä: ${Math.ceil(waveTimer)} —Å–µ–∫`,10,120);
    // –ø—É–ª–∏
    ctx.fillStyle="yellow";bullets.forEach(b=>{
        ctx.fillRect(b.x-3,b.y,6,12);
        if(b.flash&&b.flash>0){ctx.fillStyle="orange";ctx.fillRect(b.x-6,b.y-6,12,12);b.flash--;ctx.fillStyle="yellow";}
    });
    // –∑–æ–º–±–∏
    ctx.fillStyle="green";zombies.forEach(z=>ctx.fillRect(z.x,z.y,35,35));
    // –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é
    ctx.fillStyle="#0066ff";ctx.fillRect(canvas.width-90,10,80,35);
    ctx.fillStyle="white";ctx.fillText("–ú–µ–Ω—é",canvas.width-70,35);
}

/* ===== –ö–ù–û–ü–ö–ê –ú–ï–ù–Æ –ù–ê –ö–ê–ù–í–ê–°–ï ===== */
canvas.addEventListener("click",e=>{
    if(e.clientX>canvas.width-90&&e.clientX<canvas.width-10&&e.clientY>10&&e.clientY<45) openMenu();
});

function loop(){update();draw();requestAnimationFrame(loop);}
loop();
</script>
</body>
</html>