<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Zombie Shooter</title>
<style>
html, body {margin:0;padding:0;overflow:hidden;background:black;font-family:Arial;color:white;}
canvas {display:block;}
.menu,.gameover,.modes,.battlepass,.shop,.chests {position:fixed;inset:0;background:#0044cc;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10;}
.hidden {display:none;}
button {padding:14px 22px;margin:10px;font-size:18px;border:none;border-radius:10px;cursor:pointer;}
.balance {position:absolute;top:15px;right:20px;font-size:20px;}
.stats {margin-top:10px;font-size:18px;white-space: pre-line;}
.task {margin:10px;text-align:center;}
.chest-btn {position:absolute;top:10px;left:10px;padding:10px 15px;background:orange;color:black;border-radius:8px;cursor:pointer;}
</style>
</head>
<body>
<canvas id="game"></canvas>

<div id="menu" class="menu">
  <div class="balance" id="menuCoins">üí∞ 0</div>
  <h1>üßü Zombie Shooter</h1>
  <button onclick="openModes()">‚ñ∂ –ò–≥—Ä–∞—Ç—å</button>
  <button onclick="openBattlePass()">üéü –ó–∞–¥–∞–Ω–∏—è</button>
  <button onclick="openShop()">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
  <div class="stats" id="menuStats"></div>
</div>

<div id="modes" class="modes hidden">
  <h1>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º</h1>
  <button onclick="selectMode('standard')">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (5 –≤–æ–ª–Ω)</button>
  <button onclick="selectMode('christmas')">üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π‚õÑ</button>
  <button onclick="openMenu()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<div id="battlepass" class="battlepass hidden">
  <h1>üéü –ó–∞–¥–∞–Ω–∏—è</h1>
  <div class="task"><div>–£–±–∏—Ç—å 50 –∑–æ–º–±–∏</div><div id="task1"></div></div>
  <div class="task"><div>–£–±–∏—Ç—å 200 –∑–æ–º–±–∏</div><div id="task2"></div></div>
  <div class="task"><div>–£–±–∏—Ç—å 1000 –∑–æ–º–±–∏</div><div id="task3"></div></div>
  <button onclick="claimRewards()">üí∞ –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>
  <button onclick="openMenu()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<div id="shop" class="shop hidden">
  <h1>üõí –ú–∞–≥–∞–∑–∏–Ω</h1>
  <div id="shopItems"></div>
  <button onclick="openMenu()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<div id="gameover" class="gameover hidden">
  <h1>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</h1>
  <button onclick="startGame()">üîÅ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
  <button onclick="openMenu()">üìã –ú–µ–Ω—é</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
resize(); addEventListener("resize",resize);

let state="menu", zombies=[], bullets=[], kills=0, chests=[];
let coins=Number(localStorage.getItem("coins"))||0;
let totalKills=Number(localStorage.getItem("totalKills"))||0;

let wave=1,maxWaves=5,waveTime=20,waveTimer=20;
let spawnRate=0.02,zombieSpeed=1.2,lastTime=Date.now();
let currentMode="standard";

// === –û–†–£–ñ–ò–ï ===
let weapons = {
  "Pistol": {delay:0.8, bullets:1, spread:false, owned:true, price:0},
  "Tek-9": {delay:0.5, bullets:2, spread:false, owned:false, price:200},
  "Shotgun": {delay:1, bullets:5, spread:true, owned:false, price:350},
  "UMP": {delay:0.6, bullets:3, spread:true, owned:false, price:1000}
};
let currentWeapon="Pistol", lastShot=0;

let baseHP = 250;

// === –ú–ï–ù–Æ ===
function hideAll(){
  menu.classList.add("hidden");
  modes.classList.add("hidden");
  battlepass.classList.add("hidden");
  shop.classList.add("hidden");
  gameover.classList.add("hidden");
  canvas.style.pointerEvents="auto";
}
function openMenu(){hideAll();state="menu";updateMenu();menu.classList.remove("hidden");canvas.style.pointerEvents="none";}
function openModes(){hideAll();modes.classList.remove("hidden");canvas.style.pointerEvents="none";}
function openBattlePass(){hideAll();battlepass.classList.remove("hidden");updateTasks();canvas.style.pointerEvents="none";}
function openShop(){hideAll();shop.classList.remove("hidden");updateShop();canvas.style.pointerEvents="none";}
function selectMode(m){currentMode=m;startGame();}

// === HUD ===
function updateMenu(){
  menuCoins.innerText="üí∞ "+coins;
  menuStats.innerText=`–£–±–∏–π—Å—Ç–≤ –≤—Å–µ–≥–æ: ${totalKills}\n–ë–∞–∑–∞ HP: ${baseHP}`;
}
function updateTasks(){
  task1.innerText=Math.min(totalKills,50)+"/50";
  task2.innerText=Math.min(totalKills,200)+"/200";
  task3.innerText=Math.min(totalKills,1000)+"/1000";
}
function claimRewards(){coins += 50; saveProgress(); updateMenu(); alert("–ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!");}

// === –ú–ê–ì–ê–ó–ò–ù ===
function updateShop(){
  let html="";
  for(let w in weapons){
    let weap = weapons[w];
    html += `<div><b>${w}</b> - ${weap.price}üí∞<br>
      <button onclick="buyEquip('${w}')">${weap.owned ? (currentWeapon===w?"–≠–∫–∏–ø–∏—Ä–æ–≤–∞–Ω–æ":"–≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å"):"–ö—É–ø–∏—Ç—å"}</button></div>`;
  }
  shopItems.innerHTML=html;
}
function buyEquip(w){
  let weap = weapons[w];
  if(!weap.owned){
    if(coins<weap.price) return alert("–ù–µ—Ç –º–æ–Ω–µ—Ç");
    coins -= weap.price;
    weap.owned=true;
  }
  currentWeapon=w;
  updateShop(); updateMenu(); saveProgress();
}

// === –°–ü–ê–í–ù –ó–û–ú–ë–ò –ò –°–£–ù–î–£–ö–û–í ===
function spawnZombie(){ zombies.push({x:Math.random()*(canvas.width-40),y:-40,hp:1}); }
function spawnChest(){ if(Math.random()<0.001 && chests.length<3) chests.push({x:Math.random()*(canvas.width-40),y:-40,size:25}); }

// === –°–¢–†–ï–õ–¨–ë–ê ===
canvas.addEventListener("mousedown", shoot);
function shoot(e){
  if(state!=="game") return;
  let now=Date.now();
  let weap = weapons[currentWeapon];
  if(now-lastShot < weap.delay*1000) return;
  lastShot = now;

  for(let i=0;i<weap.bullets;i++){
    let offset = weap.spread ? (Math.random()*20-10) : 0;
    bullets.push({x:e.clientX+offset, y:canvas.height-80});
  }
}

// === –°–ù–ï–ì ===
let snowflakes=[];
function spawnSnow(){
  if(currentMode==="christmas"){
    for(let i=0;i<2;i++) snowflakes.push({x:Math.random()*canvas.width,y:0,r:Math.random()*3+1});
  }
}
function drawSnow(){
  ctx.fillStyle="white";
  snowflakes.forEach((s,i)=>{
    ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
    s.y += 1+s.r/2; if(s.y>canvas.height) snowflakes.splice(i,1);
  });
}

// === –°–¢–ê–†–¢ –ò–ì–†–´ ===
function startGame(){
  state="game"; zombies=[]; bullets=[]; chests=[];
  kills=0; wave=1; waveTimer=waveTime;
  spawnRate=0.02; zombieSpeed=1.2; baseHP=250;
  hideAll();
}

// === –û–ë–ù–û–í–õ–ï–ù–ò–ï ===
function update(){
  if(state!=="game") return;

  waveTimer -= 0.016;
  if(Math.random()<spawnRate) spawnZombie();
  spawnChest();
  spawnSnow();

  if(waveTimer<=0){
    wave++;
    if(currentMode==="standard" && wave>5) endGame();
    if(currentMode==="christmas" && wave>10) endGame();
    waveTimer = waveTime;
    zombieSpeed += 0.2;
    spawnRate += 0.01;
  }

  bullets.forEach(b=>b.y-=12);

  zombies.forEach((z,i)=>{
    bullets.forEach((b,j)=>{
      if(b.x>z.x && b.x<z.x+35 && b.y>z.y && b.y<z.y+35){
        z.hp--;
        bullets.splice(j,1);
        if(z.hp<=0){ zombies.splice(i,1); kills++; totalKills++; coins++; saveProgress(); }
      }
    });
    z.y += zombieSpeed;
    if(z.y > canvas.height-50) { baseHP-=35; z.y=9999; }
  });

  chests.forEach((c,i)=>{
    bullets.forEach((b,j)=>{
      if(b.x>c.x && b.x<c.x+c.size && b.y>c.y && b.y<c.y+c.size){
        coins += 5; bullets.splice(j,1); chests.splice(i,1); saveProgress();
      }
    });
    c.y += 1.5;
  });

  if(baseHP<=0) endGame();
}

// === –°–û–•–†–ê–ù–ï–ù–ò–ï ===
function saveProgress(){
  localStorage.setItem("coins", coins);
  localStorage.setItem("totalKills", totalKills);
}

// === –ö–û–ù–ï–¶ –ò–ì–†–´ ===
function endGame(){ state="over"; hideAll(); gameover.classList.remove("hidden"); updateMenu(); saveProgress(); }

// === –û–¢–†–ò–°–û–í–ö–ê ===
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(currentMode==="christmas"){ ctx.fillStyle="#1e3f66"; ctx.fillRect(0,0,canvas.width,canvas.height); }
  else ctx.fillStyle="#228B22"; ctx.fillRect(0,0,canvas.width,canvas.height);
  if(state!=="game") return;

  // –±–∞–∑–∞
  ctx.fillStyle="red"; ctx.fillRect(0,canvas.height-50,canvas.width,50);
  ctx.fillStyle="white"; ctx.font="20px Arial";
  ctx.fillText(`üß± –ë–∞–∑–∞ HP: ${baseHP}`,10,30);
  ctx.fillText(`üåä –í–æ–ª–Ω–∞ ${wave} : ${Math.ceil(waveTimer)} —Å–µ–∫`,10,60);
  ctx.fillText(`üíÄ –£–±–∏–π—Å—Ç–≤–∞: ${kills}`,10,90);

  if(currentMode==="christmas") drawSnow();

  // –ø—É–ª–∏
  ctx.fillStyle="yellow"; bullets.forEach(b=>ctx.fillRect(b.x-3,b.y,6,12));

  // –∑–æ–º–±–∏
  ctx.fillStyle="green"; zombies.forEach(z=>ctx.fillRect(z.x,z.y,35,35));

  // —Å—É–Ω–¥—É–∫–∏
  ctx.fillStyle="orange"; chests.forEach(c=>ctx.fillRect(c.x,c.y,c.size,c.size));

  // –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é –≤ –∏–≥—Ä–µ
  ctx.fillStyle="#0044cc"; ctx.fillRect(canvas.width-110,10,100,40);
  ctx.fillStyle="white"; ctx.fillText("–ú–µ–Ω—é",canvas.width-90,35);
}
canvas.addEventListener("click",(e)=>{
  if(state==="game" && e.clientX>canvas.width-110 && e.clientX<canvas.width-10 && e.clientY>10 && e.clientY<50){
    openMenu();
  }
});

// === –¶–ò–ö–õ ===
function loop(){ update(); draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>